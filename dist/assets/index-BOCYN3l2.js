import{j as o,u as C,b as k,r as p,c as E,R as L,P as A}from"./vendor-react-DwZhlL34.js";import{c as B,a as R}from"./vendor-redux-Df2g2Yqj.js";import{h as g}from"./vendor-Cpi_zIA0.js";import{u as N,a as h,D as T,c as O,S as w,v as D,b as I,s as $,K,P,d as G,C as M}from"./vendor-dndkit--z3JWhzo.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&d(c)}).observe(document,{childList:!0,subtree:!0});function l(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(s){if(s.ep)return;s.ep=!0;const r=l(s);fetch(s.href,r)}})();const y=localStorage.getItem("layoutConfig"),_={blocks:y?JSON.parse(y):[],past:[],future:[]},b=B({name:"layout",initialState:_,reducers:{addBlock(e,t){e.past.push([...e.blocks]),e.blocks.push(t.payload),e.future=[]},setBlocks(e,t){e.past.push([...e.blocks]),e.blocks=t.payload,e.future=[]},undo(e){if(e.past.length>0){const t=e.past.pop();e.future.push([...e.blocks]),e.blocks=t}},redo(e){if(e.future.length>0){const t=e.future.pop();e.past.push([...e.blocks]),e.blocks=t}}}}),{addBlock:F}=b.actions,H=b.reducer,U=()=>o.jsxs("div",{style:{background:"#dbeafe",padding:"2rem",marginBottom:"1rem"},children:[o.jsx("h2",{children:"🚀 Hero Block"}),o.jsx("p",{children:"This is a hero block with a heading, subtitle, and CTA."})]}),z=()=>o.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:[o.jsxs("div",{style:{flex:1},children:[o.jsx("h3",{children:"📄 Left Column"}),o.jsx("p",{children:"Heading, subtitle, CTA"})]}),o.jsx("div",{style:{flex:1},children:o.jsx("img",{src:"https://via.placeholder.com/150",alt:"Right side"})})]}),Y=()=>o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[o.jsx("img",{src:"https://via.placeholder.com/100",alt:"Grid 1"}),o.jsx("img",{src:"https://via.placeholder.com/100",alt:"Grid 2"}),o.jsx("img",{src:"https://via.placeholder.com/100",alt:"Grid 3"}),o.jsx("img",{src:"https://via.placeholder.com/100",alt:"Grid 4"})]});function J({id:e,children:t}){const{attributes:l,listeners:d,setNodeRef:s,transform:r,transition:c}=G({id:e}),i={transform:M.Transform.toString(r),transition:c,border:"1px solid #ccc",padding:"1rem",marginBottom:"0.5rem",background:"#fff",borderRadius:"8px"};return o.jsx("div",{ref:s,style:i,...l,...d,children:t})}function V(){const e=C(),t=k(i=>i.layout.blocks),[l,d]=p.useState(null);p.useEffect(()=>{let i=!1;g.init(n=>{var a;if(i=!0,console.log("SDK initialized:",n),n.location.is(g.locations.LOCATION_ENTRY_FULLSCREEN)){d(n);const u=(a=n.entry.fields.layoutConfig)==null?void 0:a.getValue();u&&Array.isArray(u)&&e({type:"layout/setBlocks",payload:u})}else console.log("SDK initialized, but NOT in ENTRY_FULLSCREEN location")}),i||(console.log("SDK init did not run, using mock SDK for local dev"),d({entry:{fields:{layoutConfig:{getValue:()=>[],set:a=>console.log("Mock set blocks:",a)}}},location:{is:a=>a===g.locations.LOCATION_ENTRY_FULLSCREEN}}))},[e]),p.useEffect(()=>{l&&l.entry.fields.layoutConfig.set(t)},[t,l]);const s=N(h(P),h(K,{coordinateGetter:$})),r=i=>{e(F(i))},c=i=>{const{active:n,over:a}=i;if(!a||n.id===a.id)return;const u=t.findIndex((f,m)=>`${f}-${m}`===n.id),j=t.findIndex((f,m)=>`${f}-${m}`===a.id),v=I(t,u,j);e({type:"layout/setBlocks",payload:v})};return l?o.jsxs("div",{style:{padding:"2rem"},children:[o.jsx("h2",{children:"🧱 Contentful Layout Builder"}),o.jsxs("div",{style:{marginBottom:"1rem"},children:[o.jsx("button",{onClick:()=>r("hero"),children:"Add Hero Block"}),o.jsx("button",{onClick:()=>r("two-column"),children:"Add Two Column"}),o.jsx("button",{onClick:()=>r("image-grid"),children:"Add Image Grid"}),o.jsx("button",{onClick:()=>e({type:"layout/undo"}),children:"Undo"}),o.jsx("button",{onClick:()=>e({type:"layout/redo"}),children:"Redo"})]}),o.jsx(T,{sensors:s,collisionDetection:O,onDragEnd:c,children:o.jsx(w,{items:t.map((i,n)=>`${i}-${n}`),strategy:D,children:t.map((i,n)=>o.jsxs(J,{id:`${i}-${n}`,children:[i==="hero"&&o.jsx(U,{}),i==="two-column"&&o.jsx(z,{}),i==="image-grid"&&o.jsx(Y,{})]},`${i}-${n}`))})})]}):o.jsx("div",{children:"Loading Contentful App..."})}let x;const q=e=>t=>l=>{const d=t(l);return["layout/addBlock","layout/setBlocks"].includes(l.type)&&(clearTimeout(x),x=setTimeout(()=>{const c=e.getState().layout.blocks;localStorage.setItem("layoutConfig",JSON.stringify(c)),console.log("🔁 Auto-saved layout:",c)},1e3)),d},Q=R({reducer:{layout:H},middleware:e=>e().concat(q)}),S=document.getElementById("root");S?E.createRoot(S).render(o.jsx(L.StrictMode,{children:o.jsx(A,{store:Q,children:o.jsx(V,{})})})):console.error("Root element not found");
